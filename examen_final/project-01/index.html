<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lucio Enrique Cornejo Ramírez">
<meta name="dcterms.date" content="2025-06-16">

<title>Trabajo final</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-673ef696772ae3f5d735fbdc0f05a12f.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-11cc6b83d3a89c75c242393bd9ef6be9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción">Introducción</a>
  <ul class="collapse">
  <li><a href="#marco-del-problema" id="toc-marco-del-problema" class="nav-link" data-scroll-target="#marco-del-problema">Marco del problema</a></li>
  <li><a href="#plan-de-modelamiento" id="toc-plan-de-modelamiento" class="nav-link" data-scroll-target="#plan-de-modelamiento">Plan de modelamiento</a></li>
  </ul></li>
  <li><a href="#materiales-y-métodos" id="toc-materiales-y-métodos" class="nav-link" data-scroll-target="#materiales-y-métodos">Materiales y métodos</a>
  <ul class="collapse">
  <li><a href="#datosobservaciones" id="toc-datosobservaciones" class="nav-link" data-scroll-target="#datosobservaciones">Datos/Observaciones</a></li>
  <li><a href="#itinerario-metodológico-de-la-modelización" id="toc-itinerario-metodológico-de-la-modelización" class="nav-link" data-scroll-target="#itinerario-metodológico-de-la-modelización">Itinerario metodológico de la modelización</a></li>
  </ul></li>
  <li><a href="#resultados" id="toc-resultados" class="nav-link" data-scroll-target="#resultados">Resultados</a>
  <ul class="collapse">
  <li><a href="#carga-de-datos" id="toc-carga-de-datos" class="nav-link" data-scroll-target="#carga-de-datos">Carga de datos</a></li>
  <li><a href="#filtro-de-variables" id="toc-filtro-de-variables" class="nav-link" data-scroll-target="#filtro-de-variables">Filtro de variables</a></li>
  <li><a href="#variables-categóricas" id="toc-variables-categóricas" class="nav-link" data-scroll-target="#variables-categóricas">Variables categóricas</a></li>
  <li><a href="#variables-finales" id="toc-variables-finales" class="nav-link" data-scroll-target="#variables-finales">Variables finales</a></li>
  </ul></li>
  <li><a href="#discusión" id="toc-discusión" class="nav-link" data-scroll-target="#discusión">Discusión</a></li>
  <li><a href="#conclusiones" id="toc-conclusiones" class="nav-link" data-scroll-target="#conclusiones">Conclusiones</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Trabajo final</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lucio Enrique Cornejo Ramírez </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introducción" class="level2">
<h2 class="anchored" data-anchor-id="introducción">Introducción</h2>
<section id="marco-del-problema" class="level3">
<h3 class="anchored" data-anchor-id="marco-del-problema">Marco del problema</h3>
<p>Entre los costos que más desastibilizan económicamente a las personas, se encuentra el pago por procedimientos médicos. Estos precios pueden variar en gran medida dependiendo de características del paciente, como detallaremos más adelante.</p>
<p>En ese sentido, resulta de gran valor predecir adecuadamente el costo que un seguro médico cubrirá, respecto a un procedimiento médico. Para un paciente, aquella predicción puede servir para que planifique qué tanto sería desestabilizado económicamente debido a algún tipo de procedimiento particular. Por otro lado, también para las aseguradoras resulta útil aquellas predicciones, ya que pueden anticipar qué tanto dinero estarían perdiendo por el monto a cubrir de la operación; además, con ese conocimiento pueden monitorear mejor qué pedidos de cobertura resultan anómalos, potencialmente fraudulentos.</p>
</section>
<section id="plan-de-modelamiento" class="level3">
<h3 class="anchored" data-anchor-id="plan-de-modelamiento">Plan de modelamiento</h3>
<p>Anteriormente, hemos planteado como variable por predecir a la cantidad monetaria que la aseguradora de un paciente cubrirá debido a un procedimiento médico. Note que aquel monto está muy relacionado al precio que paga el paciente luego que el seguro descuenta parte del costo del procedimiento médico … ese monto, que denominaremos <code>charges</code>, se intentará predecir.</p>
<p>Asimismo, vale recalcar la influencia de los gastos del hospital debido al procedimiento médico, variable que denotaremos <code>Hospital_expenditure</code>, sobre <code>charges</code>.</p>
<p>Para el modelamiento, se considerará además las siguientes características del paciente:</p>
<ul>
<li>Sexo (<code>age</code>)</li>
<li>Si fuma o no (<code>smoker</code>)</li>
<li>Región de la que provee (<code>region</code>)</li>
<li>Edad (<code>age</code>)</li>
<li>Índice de masa corporal (<code>bmi</code>)</li>
<li>Cantidad de hijos e hijas (<code>children</code>)</li>
<li>Costo médico que pagaría en caso no se aplicase seguro médico (<code>Claim_Amount</code>)</li>
<li>Número de procedimientos pasados (<code>past_consultations</code>)</li>
<li>Número de pasos que realizó en cierto día (<code>num_of_steps</code>)</li>
<li>Número de veces que ha sido hospitalizado (<code>Number_of_past_hospitalizations</code>)</li>
<li>Salario anual (<code>Anual_Salary</code>)</li>
</ul>
</section>
</section>
<section id="materiales-y-métodos" class="level2">
<h2 class="anchored" data-anchor-id="materiales-y-métodos">Materiales y métodos</h2>
<section id="datosobservaciones" class="level3">
<h3 class="anchored" data-anchor-id="datosobservaciones">Datos/Observaciones</h3>
<p>Las observaciones que consideraremos para este proyecto fueron descargadas de este sitio <a href="https://www.kaggle.com/datasets/shubhamsingh57/ml-model-practice-linear-regression/data">web</a>.</p>
<p>Estos datos son de distintos pacientes que recibieron algún tipo de tratamiento médico, de los cuales se tienen variables recopiladas, como edad, sexo, si fuma o no, etc. Así, descartamos que los datos consistan de una serie de tiempo.</p>
<p>No obstante, aquella página web no provee información más específica sobre el origen de los datos. Por ejemplo, si han sido recopilados en un único hospital, o en diversos hospitales, pero de qué país, etc.</p>
<p>Aún así, en esta investigación, no solo se considera la predicción de la variable mencionada, sino también cómo es que influyen las variables que emplearemos como regresores, en la predicción final. Por ejemplo, si su relación es directa o inversamente proporcional.</p>
<p>A continuación justificamos el posible uso de los caracteres presentes en los datos, como covariables:</p>
<ul>
<li><strong>Sexo</strong>: Debido al riesgo y costos distintos entre hombres y mujeres, para ciertos tipos de operaciones; por ejemplo, parto.</li>
<li><strong>Si fuma o no</strong>: Pues fumar aumenta la probabilidad de desarrollar complicaciones médicas</li>
<li><strong>Región de la que provee</strong>: Ya que el costo de un procedimiento médico puede variar mucho por región, así que también varía cuánto cubriría una aseguradora.</li>
<li><strong>Edad</strong>: Puesto que pacientes mayores suelen requerir más cuidados.</li>
<li><strong>Índice de masa corporal</strong>: En base a que un IMC elevado está asociado a mayores riesgos durante cirugías.</li>
<li><strong>Cantidad de hijos e hijas</strong>: Esto puede influir en el tipo de cobertura familiar (de seguro) que tiene el paciente.</li>
<li><strong>Costo médico que pagaría en caso no se aplicase seguro médico</strong>: Importante incluirlo, pues incluso se espera que presente una fuerte correlación positiva con la variable por predecir.</li>
<li><strong>Número de procedimientos pasados</strong>: Puede resultar útil en base a que pacientes con muchos procedimientos suelen tener enfermedades crónicas, por lo que se esperaría una mayor cobertura.</li>
<li><strong>Número de pasos que realizó en cierto día</strong>: Esta variable tampoco se explica en la fuente, pero la podemos considerar como una medida de la condición física de una persona, qué tan activa es.</li>
<li><strong>Número de veces que ha sido hospitalizado</strong>: Pues más hospitalizaciones implican mayor riesgo en la operación, aumentando posiblemente así los costos que cubre la aseguradora.</li>
<li><strong>Salario anual</strong>: Como indicador de nivel socioeconómico, se espera que pacientes con ingresos altos cuenten con aseguradoras que cubren mayor parte el costo por intervención médica.</li>
</ul>
</section>
<section id="itinerario-metodológico-de-la-modelización" class="level3">
<h3 class="anchored" data-anchor-id="itinerario-metodológico-de-la-modelización">Itinerario metodológico de la modelización</h3>
<p>A continuación, describrimos los pasos a seguir para la construcción de diferentes modelos de predicción:</p>
<ol type="1">
<li><p>Descarte de observaciones que presenten algún valor faltante para cualquier variable.</p></li>
<li><p>Gráficos de dispersión para pares de variables</p></li>
<li><p>Debido al máximo establecido en este proyecto, respecto al número de covariables, calculamos las correlaciones múltiples</p></li>
<li><p>Filtro de observaciones al azar, debido a máximo establecido en este proyecto.</p></li>
<li><p>Limpieza de datos</p></li>
<li><p>Construcción del modelo OLS, empleando todas las covariables</p></li>
<li><p>Gráficos de valores observados y residuos contra valores estimados. Interpretar R^2</p></li>
<li><p>Emplear el test de Levine y Shapiro para averiguar la homocedasticidad y la normalidad.</p></li>
<li><p>En caso positivo, evaluar por medio de ANOVA si el modelo tiene sentido. En caso positivo, determinar qué variables explicativas tienen sentido.</p></li>
<li><p>Si se encuentran puntos aberrantes, recorrer el modelo sin aquellos y repetir los pasos mencionados.</p></li>
<li><p>Ejecutar los tests de tipo ANOVA</p></li>
<li><p>En caso positivo, incluir los tests post-hoc</p></li>
</ol>
</section>
</section>
<section id="resultados" class="level2">
<h2 class="anchored" data-anchor-id="resultados">Resultados</h2>
<section id="carga-de-datos" class="level3">
<h3 class="anchored" data-anchor-id="carga-de-datos">Carga de datos</h3>
<p>A continuación, mostramos los datos descargados del sitio web mencionado en la sección previa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"./new_insurance_data.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,338
Columns: 13
$ age                             &lt;dbl&gt; 18, 18, 18, 18, 18, 18, 18, 18, 18, 18~
$ sex                             &lt;chr&gt; "male", "male", "male", "male", "male"~
$ bmi                             &lt;dbl&gt; 23.21, 30.14, 33.33, 33.66, 34.10, 34.~
$ children                        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~
$ smoker                          &lt;chr&gt; "no", "no", "no", "no", "no", "no", "n~
$ Claim_Amount                    &lt;dbl&gt; 29087.543, 39053.674, 39023.628, 28185~
$ past_consultations              &lt;dbl&gt; 17, 7, 19, 11, 16, 20, 13, 12, 17, 19,~
$ num_of_steps                    &lt;dbl&gt; 715428, 699157, 702341, 700250, 711584~
$ Hospital_expenditure            &lt;dbl&gt; 4720921.0, 4329831.7, 6884860.8, 42747~
$ Number_of_past_hospitalizations &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, NA~
$ Anual_Salary                    &lt;dbl&gt; 55784970, 13700885, 73523107, 75819680~
$ region                          &lt;chr&gt; "southeast", "southeast", "southeast",~
$ charges                         &lt;dbl&gt; 1121.874, 1131.507, 1135.941, 1136.399~</code></pre>
</div>
</div>
<p>Descartamos las observaciones con alguna variable faltante</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cantidad de observaciones</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1338</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cantidad de observaciones con alguna variable faltante</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">complete.cases</span>(datos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 51</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtro-de-variables" class="level3">
<h3 class="anchored" data-anchor-id="filtro-de-variables">Filtro de variables</h3>
<section id="graficos-de-dispersión" class="level4">
<h4 class="anchored" data-anchor-id="graficos-de-dispersión">Graficos de dispersión</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>covariables_numericas <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bmi"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"children"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Claim_Amount"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"past_consultations"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"num_of_steps"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Hospital_expenditure"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Number_of_past_hospitalizations"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Anual_Salary"</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>columnas_numericas <span class="ot">&lt;-</span> <span class="fu">c</span>(covariables_numericas, <span class="st">"charges"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(datos[, columnas_numericas])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Nótese que la variable por predecir, <code>charges</code>, parece presentar una relación lineal con la covariable <code>Annual_Salary</code>. Asimismo, parece haber indicios de que resulta posible transformar las variables <code>num_of_steps</code> y <code>Hospital_expenditure</code> por funciones logaritmo y exponcial, respectivamente, con fin que se tenga una fuerte relación lineal entre el predictor creado y la variable por predecir.</p>
</section>
<section id="correlaciones-parciales-entre-covariables" class="level4">
<h4 class="anchored" data-anchor-id="correlaciones-parciales-entre-covariables">Correlaciones parciales entre covariables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>d.cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(datos[, covariables_numericas])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>d.inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(d.cor)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>d.corm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1-1</span><span class="sc">/</span><span class="fu">diag</span>(d.inv))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">length</span>(d.corm)  </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>d.part <span class="ot">&lt;-</span> d.inv</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>pd) {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>)) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    d.part[i,j] <span class="ot">&lt;-</span> <span class="sc">-</span>d.inv[i,j]<span class="sc">/</span><span class="fu">sqrt</span>(d.inv[i,i]<span class="sc">*</span>d.inv[j,j])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  d.part[i,i] <span class="ot">&lt;-</span> d.corm[i]</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  d.part[<span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>),i] <span class="ot">&lt;-</span> d.part[i,<span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>)]  </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>d.part</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        age          bmi     children
age                              0.66869810  0.125138033 -0.127797419
bmi                              0.12513803  0.283723310  0.027431191
children                        -0.12779742  0.027431191  0.285534954
Claim_Amount                    -0.04743308  0.019145260 -0.007971203
past_consultations              -0.03242764  0.002848758  0.011798696
num_of_steps                     0.58296028 -0.073153318  0.147382251
Hospital_expenditure             0.30690425  0.031794571  0.128345835
Number_of_past_hospitalizations -0.02225606 -0.018175497  0.140432728
Anual_Salary                    -0.38460223  0.034625132 -0.173171362
                                Claim_Amount past_consultations num_of_steps
age                             -0.047433079       -0.032427643   0.58296028
bmi                              0.019145260        0.002848758  -0.07315332
children                        -0.007971203        0.011798696   0.14738225
Claim_Amount                     0.439018730       -0.005991357   0.09098912
past_consultations              -0.005991357        0.630532156   0.13217102
num_of_steps                     0.090989121        0.132171021   0.93080551
Hospital_expenditure            -0.016667332       -0.087954734  -0.49727359
Number_of_past_hospitalizations  0.023096940       -0.056723682   0.45898240
Anual_Salary                     0.052074797        0.162444557   0.56078648
                                Hospital_expenditure
age                                       0.30690425
bmi                                       0.03179457
children                                  0.12834583
Claim_Amount                             -0.01666733
past_consultations                       -0.08795473
num_of_steps                             -0.49727359
Hospital_expenditure                      0.98147153
Number_of_past_hospitalizations          -0.04913622
Anual_Salary                              0.95773182
                                Number_of_past_hospitalizations Anual_Salary
age                                                 -0.02225606  -0.38460223
bmi                                                 -0.01817550   0.03462513
children                                             0.14043273  -0.17317136
Claim_Amount                                         0.02309694   0.05207480
past_consultations                                  -0.05672368   0.16244456
num_of_steps                                         0.45898240   0.56078648
Hospital_expenditure                                -0.04913622   0.95773182
Number_of_past_hospitalizations                      0.86849267   0.13449231
Anual_Salary                                         0.13449231   0.98774064</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>vals_diag <span class="ot">&lt;-</span> <span class="fu">diag</span>(d.part)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>max_col_indices <span class="ot">&lt;-</span> <span class="fu">apply</span>(d.part, <span class="dv">1</span>, which.max)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>idx_ordenados <span class="ot">&lt;-</span> <span class="fu">order</span>(vals_diag, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>ordenados_vals_diag <span class="ot">&lt;-</span> vals_diag[idx_ordenados]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>ordenados_max_cols <span class="ot">&lt;-</span> max_col_indices[idx_ordenados]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">correlacion_parcial =</span> ordenados_vals_diag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                correlacion_parcial
Anual_Salary                              0.9877406
Hospital_expenditure                      0.9814715
num_of_steps                              0.9308055
Number_of_past_hospitalizations           0.8684927
age                                       0.6686981
past_consultations                        0.6305322
Claim_Amount                              0.4390187
children                                  0.2855350
bmi                                       0.2837233</code></pre>
</div>
</div>
<p>Note que cuatro covariables presentan correlación parcial mayor a 0.8, en orden descendente <code>Anual_Salary</code>, <code>Hospital_expenditure</code>, <code>num_of_steps</code> y <code>Number_of_past_hospitalizations</code>. Aquellas variables son muy explicadas por las demás (posible multicolinearidad).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Inspeccionemos ahora, de manera particular, las correlaciones entre covariables</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Observamos una alta correlación entre <code>Anual_Salary</code> y <code>Hospital_expenditure</code>, con un valor de 0.9692177. Asimismo, como la variable de salario anual es más sencilla de recopilar (por ejemplo, en una encuesta) que la de gasto de hospital, descartamos la variable cuantitativa <code>Hospital_expenditure</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Anual_Salary, <span class="at">y =</span> Hospital_expenditure)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Salario anual"</span>, <span class="at">y =</span> <span class="st">"Gasto del hospital"</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variable-cuantitativa-num_of_steps" class="level4">
<h4 class="anchored" data-anchor-id="variable-cuantitativa-num_of_steps">Variable cuantitativa <code>num_of_steps</code></h4>
<p>Inicialmente se consideró descartar la variable referente al número de pasos que realizó el paciente en cierto día. Esto pues, a primera vista, no se esperaría que tal información resulte relevante para el costo final por el procedimiento médico.</p>
<p>Graficamos tal posible regreso contra la variable respuesta:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_of_steps, <span class="at">y =</span> charges)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Número de pasos"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En base a que la relación parece asemejarse a una exponencial, graficamos la variable <code>num_of_steps</code> contra el logaritmo de la variable respuesta:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scaled_rsp =</span> <span class="fu">log</span>(charges)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_of_steps, <span class="at">y =</span> scaled_rsp)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Número de pasos"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En base a que aquella relación parece ser <em>aproximadamente</em> lineal, optamos por no descartar la variable cuantitativa <code>num_of_steps</code>.</p>
</section>
<section id="variable-cuantitativa-num_of_steps-1" class="level4">
<h4 class="anchored" data-anchor-id="variable-cuantitativa-num_of_steps-1">Variable cuantitativa <code>num_of_steps</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_of_steps, <span class="at">y =</span> charges)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Número de pasos"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variable-cuantitativa-age" class="level4">
<h4 class="anchored" data-anchor-id="variable-cuantitativa-age">Variable cuantitativa <code>age</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> charges)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Edad"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variable-cuantitativa-bmi" class="level4">
<h4 class="anchored" data-anchor-id="variable-cuantitativa-bmi">Variable cuantitativa <code>bmi</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bmi, <span class="at">y =</span> charges)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Índice de masa corporal"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variable-cuantitativa-children" class="level4">
<h4 class="anchored" data-anchor-id="variable-cuantitativa-children">Variable cuantitativa <code>children</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> children, <span class="at">y =</span> charges)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Número de hijos"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variable-cuantitativa-past_consultations" class="level4">
<h4 class="anchored" data-anchor-id="variable-cuantitativa-past_consultations">Variable cuantitativa <code>past_consultations</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> past_consultations, <span class="at">y =</span> charges)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Número de procedimientos pasados"</span>, <span class="at">y =</span> <span class="st">"Pago final"</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Descartamos la variable cuantitativa <code>children</code>, pues, en base a este simple análisis inicial, no parece indicar algún de tipo de relación lineal con la variable por predecir. Es más, su gráfico de dispersión parece sugerir que consideremos a la variable <code>children</code> como cualitativa.</p>
</section>
</section>
<section id="variables-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="variables-categóricas">Variables categóricas</h3>
<p>Para el filtro de variables categóricas, descartaremos aquella para la cual las distribuciones de la variable respuesta, respecto a los valores de aquella variable categórica sean relativamente similares.</p>
<section id="variable-cualitativa-region" class="level4">
<h4 class="anchored" data-anchor-id="variable-cualitativa-region">Variable cualitativa <code>region</code></h4>
<p>Inspeccionamos la distribución de la variable respuesta, respecto a los valores de la variable categórica <code>region</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> charges, <span class="at">color =</span> region, <span class="at">fill =</span> region)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Densidad de 'charges' para cada categoría de 'region'"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"charges"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Densidad"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En base a que aquellas funciones densidad no presentan una difencia resaltante, descartaremos la variable <code>region</code>. De esa manera, las variables cualitativas que emplearemos para esta investigación son solo <code>sex</code> y <code>smoker</code>.</p>
</section>
</section>
<section id="variables-finales" class="level3">
<h3 class="anchored" data-anchor-id="variables-finales">Variables finales</h3>
<ul>
<li>Variables cualitativas:
<ul>
<li><code>sex</code></li>
<li><code>smoker</code></li>
</ul></li>
<li>Variables cuantitativas:
<ul>
<li><code>age</code></li>
<li><code>bmi</code></li>
<li><code>Claim_Amount</code></li>
<li><code>past_consultations</code></li>
<li><code>num_of_steps</code></li>
<li><code>Number_of_past_hospitalizations</code></li>
<li><code>Anual_Salary</code></li>
<li><code>charges</code> (<strong>variable respuesta</strong>)</li>
</ul></li>
</ul>
<section id="base-de-datos" class="level4">
<h4 class="anchored" data-anchor-id="base-de-datos">Base de datos</h4>
<p>La base de datos consiste de 1287 observaciones. Si eliminamos filas que posean algún dato vacío, se tienen 1287 observaciones.</p>
<p>Para limitarnos a 500 filas, realizaremos un muestreo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>datos_finales <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    smoker,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    age,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    bmi,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    Claim_Amount,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    past_consultations,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    num_of_steps,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    Number_of_past_hospitalizations,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    Anual_Salary,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    charges</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>datos_finales <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">sample_n</span>(datos_finales, <span class="dv">500</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(datos_finales, <span class="st">'./datos.xlsx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="discusión" class="level2">
<h2 class="anchored" data-anchor-id="discusión">Discusión</h2>
</section>
<section id="conclusiones" class="level2">
<h2 class="anchored" data-anchor-id="conclusiones">Conclusiones</h2>
<!-- 
  → preparación de datos 
  → exploración 
  → modelado
  → evaluación
  → diagnóstico
  → mejora del modelo

1. Introducción
Presenta el dataset elegido y el objetivo del análisis.

Describe brevemente las variables y el contexto.

2. Limpieza y preparación de los datos (Clase "Start")
Tratar los valores faltantes:

“Como se resultan dos valores faltantes, se decide de tirar las observaciones correspondientes.”

3. Exploración inicial (Clase 02)
Gráficos de parejas de variables y comentarios:

Esto te ayuda a entender relaciones lineales potenciales, detectar colinealidad y valores extremos.

#####################################################

4. Primer modelo OLS básico (Clase 03)
Resultados del modelo inicial

Tabla de análisis de la varianza (ANOVA)

Plot de valores observados y residuos contra valores estimados

5. Evaluación de significancia (Clase 04)
Estadística F del modelo (p < 5%)

Pruebas t para cada variable (p < 5%)

Comparación de modelos usando el error estándar residual

6. Selección de variables (Clase 05)
Correlación parcial entre variables

Selección hacia adelante, hacia atrás y stepwise en dos modelos distintos

Comparación de los modelos obtenidos: ¿coinciden? ¿cuál parece mejor?

7. Diagnóstico de supuestos (Clase 06 y 07)
Buscar puntos aberrantes y repetir el modelo sin ellos

Tests de supuestos clásicos:

Levene (homocedasticidad)

Shapiro-Wilk (normalidad)

Discusión de cuándo es válido el ANOVA, basado en los supuestos

8. Modelo con interacciones y comparación ANOVAs (Clase 08)
Modelo extendido con interacciones (por ejemplo, con "competición")

Correr y comparar las tres ANOVA (modelo base, con interacción, etc.)

Incluir tests post-hoc si aplica

Evaluar impacto en R², significancia de interacciones, etc.

9. Conclusiones
¿Qué modelo final seleccionas y por qué?

¿Cuáles variables explican mejor la variable respuesta?

Reflexión crítica sobre las limitaciones (validez de supuestos, tamaño muestral, etc.)

-->
<!-- 

## Start

- Como se resultan dos valores faltantes, se decide de tirar las observaciones correspondientes.


## 02

- hacer gráficos de parejas de variables y comentar

## 03

- resultados
- tabla de analisis de la varianza
- el apalancamiento de las unidades
- dos plot de valores observados y residuos contra los valores estimados
- ¿a través de las tablas de análisis de varianza, ¿cual modelo le
parece mejor?
- tirar dos unidades con mayor apalancamiento,
comentar el cambio, incluyendo gráficos con
valores estimados y errores en los dos casos
- mostrar la diferencia entre betas y entre los residuos de los dos modelos.

## 04

- Evaluar si el modelo tiene sentido (Estadística F, umbral 5%) y si todas
las variables explicativas tienen sentido (t de student, umbral 5%).
- Considerando el resíduo promedio (Residual standard error), ¿cual
modelo le parece mejor?

## 05

- ¿cuales son las especialidades mejor explicadas para las demás?
- ¿cuales las parejas con más alta correlación parcial?
- modelar dos especialidades con selección para adelante, para atrás y
stepwise de las demás. ¿Sale el mismo modelo o cual le parece mejor?
- Reporte shown by teacher, en pregunta 9

## 06

- Si se encuentran puntos aberrantes, recorrer el modelo sin esos y hacer
de nuevo todos los test.
- Look for puntos aberrantes, luego recorrer modelo sin ellos

## 07

- qq-plot for residuals
- correr test de Levine y Shapiro para averiguar la homocedasticidad y la
normalidad.
- correr el ANOVA con el modelo lineal si lo test se lo permiten: 
- Comment del profe: `
No siempre se cumplen los requisitos de homocedasticidad y normalidad. Esto limita la aplicación de la anova ya que la estimación de la varianza no es más posible. De consecuencia las probabilidades asociadas a las estadísticas solo cuantifican la relevancia de las diferencias observadas, pero no pueden ser empleadas estadísticamente.

De todo modo, las anovas muestran una calidad muy alta, con un R2
igual a .82, .82, .84 y .85 respectivamente. Este valor mejora mucho cuando se tira el intercepta en el modelo, llegando a 99.7, 99.8, 99.9 y 99.5 respectivamente. La interacción resulta significativa solo para aletas y masa.
`

## 08

- ver cosa cambia, incluyendo interacciones con la competición y correndo las tres anova
- incluir los test post-hoc

-->
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>